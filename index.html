<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secured Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { brand: '#4f46e5', bg: '#f8fafc', surface: '#ffffff' },
                    boxShadow: { 'float': '0 10px 40px -10px rgba(79, 70, 229, 0.2)' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; color: #334155; padding-bottom: 100px; }
        
        .input-box {
            width: 100%; background: #f1f5f9; border: 2px solid transparent; 
            padding: 12px 16px; border-radius: 12px; font-weight: 500; font-size: 14px;
            transition: all 0.2s; outline: none;
        }
        .input-box:focus { background: white; border-color: #4f46e5; box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); }

        /* Login Screen specific */
        .login-glass {
            background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6); box-shadow: 0 20px 50px -10px rgba(0,0,0,0.1);
        }

        /* Floating Nav */
        .nav-island {
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .nav-btn.active { color: #4f46e5; background: #eef2ff; }
        .nav-btn { color: #94a3b8; transition: all 0.3s; }

        .hidden-force { display: none !important; }
        
        /* Category Popup */
        .cat-trigger { cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
        .cat-popup {
            position: absolute; top: 110%; left: 0; width: 100%; background: white; border-radius: 16px; padding: 10px;
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; opacity: 0; pointer-events: none; 
            transform: translateY(-10px); transition: all 0.2s ease-out; z-index: 50; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 300px; overflow-y: auto;
        }
        .cat-popup.active { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .cat-item { padding: 10px; font-size: 12px; font-weight: 600; text-align: center; border-radius: 8px; background: #f8fafc; color: #64748b; cursor: pointer; border: 1px solid transparent; transition: 0.2s; }
        .cat-item:hover { background: #eef2ff; color: #4f46e5; border-color: #c7d2fe; }
        .cat-item.selected { background: #4f46e5; color: white; }
    </style>
</head>
<body class="min-h-screen">

    <!-- =========================== -->
    <!-- VIEW: LOGIN SCREEN (Overlay) -->
    <!-- =========================== -->
    <section id="view-login" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#f1f5f9] p-4">
        <div class="w-full max-w-sm login-glass p-8 rounded-3xl text-center">
            <div class="w-16 h-16 bg-brand rounded-2xl flex items-center justify-center text-white text-2xl mx-auto mb-6 shadow-lg shadow-indigo-300">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h2 class="text-2xl font-bold text-slate-800 mb-1">Admin Access</h2>
            <p class="text-slate-400 text-sm mb-8">Enter your credentials to manage library</p>
            
            <div class="space-y-4">
                <input type="password" id="login-pass" class="input-box text-center tracking-widest text-lg" placeholder="••••••••">
                <button onclick="checkLogin()" class="w-full bg-brand hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2">
                    <span>Unlock Dashboard</span>
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>
            <p id="login-error" class="text-red-500 text-xs font-bold mt-4 opacity-0 transition-opacity">Incorrect Password</p>
        </div>
    </section>

    <!-- =========================== -->
    <!-- MAIN CONTENT WRAPPER (Hidden Initially) -->
    <!-- =========================== -->
    <div id="main-app" class="hidden-force">

        <!-- EDIT MODAL -->
        <div id="edit-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm px-4">
            <div class="w-full max-w-md bg-white p-6 rounded-3xl shadow-2xl">
                <h3 class="font-bold text-lg text-slate-800 mb-4">Edit Book Details</h3>
                <div class="space-y-3">
                    <input type="hidden" id="edit-id"><input type="hidden" id="edit-old-title">
                    <input id="edit-title" class="input-box" placeholder="Title">
                    <input id="edit-poster" class="input-box" placeholder="Poster URL">
                    <input id="edit-link" class="input-box" placeholder="Link">
                    <textarea id="edit-desc" rows="3" class="input-box resize-none" placeholder="Description"></textarea>
                    
                    <div class="flex gap-3 mt-4">
                        <button onclick="closeEdit()" class="flex-1 py-3 bg-slate-100 text-slate-600 rounded-xl font-bold text-sm">Cancel</button>
                        <button onclick="saveGlobalEdit()" class="flex-1 py-3 bg-brand text-white rounded-xl font-bold text-sm shadow-lg shadow-indigo-200">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: HOME (Master List) -->
        <section id="view-home" class="p-6 max-w-5xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">Library Master</h1>
                    <p class="text-xs font-semibold text-slate-400 mt-1">Search & Destroy Mode</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="location.reload()" class="bg-white text-slate-600 border border-slate-200 h-10 w-10 rounded-full flex items-center justify-center shadow-sm">
                        <i class="fa-solid fa-rotate-right"></i>
                    </button>
                    <button onclick="logout()" class="bg-red-50 text-red-500 border border-red-100 h-10 w-10 rounded-full flex items-center justify-center shadow-sm hover:bg-red-500 hover:text-white transition-all">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </header>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <div class="bg-slate-50/50 p-4 border-b border-slate-100 grid grid-cols-[50px_1fr_80px] gap-4 text-xs font-bold text-slate-400 uppercase">
                    <div class="text-center">Img</div>
                    <div>Details</div>
                    <div class="text-right">Manage</div>
                </div>
                <div id="home-list" class="max-h-[70vh] overflow-y-auto"></div>
            </div>
        </section>

        <!-- VIEW: DAILY (Upload) -->
        <section id="view-daily" class="hidden-force p-6 max-w-6xl mx-auto">
            <header class="flex justify-between items-center mb-8">
                <h1 class="text-2xl font-bold text-slate-800">Upload Studio</h1>
                <button onclick="logout()" class="bg-red-50 text-red-500 border border-red-100 h-10 w-10 rounded-full flex items-center justify-center shadow-sm hover:bg-red-500 hover:text-white transition-all">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </button>
            </header>

            <div class="flex flex-col lg:flex-row gap-8">
                <!-- FORM -->
                <div class="w-full lg:w-[400px] shrink-0">
                    <div class="bg-white p-6 rounded-3xl shadow-float border border-white sticky top-6">
                        <div class="mb-4 relative">
                            <label class="text-xs font-bold text-slate-400 uppercase ml-2 mb-1 block">Category</label>
                            <input type="hidden" id="selected-category-value">
                            <div class="input-box cat-trigger" onclick="toggleCategoryPopup()">
                                <span id="cat-display-text" class="text-slate-400">Select Category</span>
                                <i class="fa-solid fa-chevron-down text-xs"></i>
                            </div>
                            <div id="category-popup" class="cat-popup">
                                <div class="cat-item" onclick="selectCat('Trending')">Trending</div>
                                <div class="cat-item" onclick="selectCat('Self Improvement')">Self Improv.</div>
                                <div class="cat-item" onclick="selectCat('Hindi Sahitya')">Hindi Sahitya</div>
                                <div class="cat-item" onclick="selectCat('Hindi Kavya')">Hindi Kavya</div>
                                <div class="cat-item" onclick="selectCat('Developers Favourite')">Dev Favourites</div>
                                <div class="cat-item" onclick="selectCat('English Books')">English Books</div>
                                <div class="cat-item" onclick="selectCat('YTC')">YTC</div>
                                <div class="cat-item" onclick="selectCat('Speedy')">Speedy</div>
                                <div class="cat-item" onclick="selectCat('Ghatnachakra')">Ghatnachakra</div>
                                <div class="cat-item" onclick="selectCat('Kiran Publication')">Kiran Pub.</div>
                                <div class="cat-item" onclick="selectCat('RWA Books')">RWA Books</div>
                                <div class="cat-item" onclick="selectCat('Pinnacle')">Pinnacle</div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div><input id="in-title" class="input-box" placeholder="Book Title"></div>
                            <div><input id="in-poster" class="input-box" placeholder="Poster Image URL"></div>
                            <div><input id="in-link" class="input-box" placeholder="PDF / Drive Link"></div>
                            <div><textarea id="in-desc" rows="3" class="input-box resize-none" placeholder="Description"></textarea></div>
                        </div>
                        <button onclick="upload()" class="w-full bg-brand hover:bg-indigo-700 text-white font-bold py-4 rounded-xl mt-6 shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2">
                            <i class="fa-solid fa-cloud-arrow-up"></i> Upload Book
                        </button>
                    </div>
                </div>

                <!-- DAILY LIST -->
                <div class="flex-1 bg-white rounded-3xl border border-slate-100 shadow-sm overflow-hidden flex flex-col h-[600px]">
                    <div class="p-5 border-b border-slate-50 flex justify-between items-center">
                        <h3 class="font-bold text-slate-700">Daily Queue</h3>
                        <span id="daily-count" class="text-xs bg-slate-100 px-3 py-1 rounded-full font-bold text-slate-500">0</span>
                    </div>
                    <div id="daily-list" class="flex-1 overflow-y-auto p-2"></div>
                </div>
            </div>
        </section>

        <!-- FLOATING BOTTOM NAV -->
        <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-40 w-auto">
            <nav class="nav-island flex items-center gap-2 p-2 rounded-full shadow-float">
                <button onclick="switchTab('home')" id="btn-home" class="nav-btn active flex items-center gap-2 px-6 py-3 rounded-full">
                    <i class="fa-solid fa-layer-group"></i><span class="text-sm font-bold">Home</span>
                </button>
                <button onclick="switchTab('daily')" id="btn-daily" class="nav-btn flex items-center gap-2 px-6 py-3 rounded-full">
                    <i class="fa-solid fa-plus-circle"></i><span class="text-sm font-bold">Daily</span>
                </button>
            </nav>
        </div>
    </div>

    <!-- LOGIC -->
    <script>
        // --- AUTHENTICATION LOGIC ---
        const PASSWORD = "Prince16@";

        // Check login on load
        window.onload = function() {
            if(sessionStorage.getItem("isAdmin") === "true") {
                showDashboard();
            }
        };

        function checkLogin() {
            const input = document.getElementById('login-pass').value;
            const error = document.getElementById('login-error');
            
            if(input === PASSWORD) {
                sessionStorage.setItem("isAdmin", "true");
                showDashboard();
            } else {
                error.style.opacity = "1";
                setTimeout(() => error.style.opacity = "0", 2000);
            }
        }

        // Allow Enter key to login
        document.getElementById('login-pass').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkLogin();
        });

        function showDashboard() {
            document.getElementById('view-login').classList.add('hidden-force');
            document.getElementById('main-app').classList.remove('hidden-force');
            fetchHomeBooks(); // Load data only after login
        }

        function logout() {
            sessionStorage.removeItem("isAdmin");
            location.reload();
        }

        // --- UI FUNCTIONS ---
        function toggleCategoryPopup() { document.getElementById('category-popup').classList.toggle('active'); }
        function selectCat(value) {
            document.getElementById('selected-category-value').value = value;
            const display = document.getElementById('cat-display-text');
            display.innerText = value; display.classList.remove('text-slate-400'); display.classList.add('text-indigo-600');
            toggleCategoryPopup();
        }
        document.addEventListener('click', function(e) {
            const trigger = document.querySelector('.cat-trigger'); const popup = document.querySelector('.cat-popup');
            if (!trigger.contains(e.target) && !popup.contains(e.target)) popup.classList.remove('active');
        });

        function switchTab(tab) {
            document.getElementById('view-home').classList.add('hidden-force');
            document.getElementById('view-daily').classList.add('hidden-force');
            document.getElementById('btn-home').classList.remove('active');
            document.getElementById('btn-daily').classList.remove('active');

            if(tab === 'home') {
                document.getElementById('view-home').classList.remove('hidden-force');
                document.getElementById('btn-home').classList.add('active');
                fetchHomeBooks();
            } else {
                document.getElementById('view-daily').classList.remove('hidden-force');
                document.getElementById('btn-daily').classList.add('active');
                fetchDailyBooks();
            }
        }

        // --- SUPABASE & DATA LOGIC ---
        const DB_CONFIG = {
            "Home": { url: 'https://xhodhhuyuspqygyrwlgv.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhob2RoaHV5dXNwcXlneXJ3bGd2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYyODAxNjAsImV4cCI6MjA4MTg1NjE2MH0.BQyWGCEyPBF8wXcF2jhOEC-5fnfeBKyt7xlMNHl4k1M', table: 'books' },
            "Daily": { url: 'https://nfucebikqvstzgkeyeif.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mdWNlYmlrcXZzdHpna2V5ZWlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY0ODM5MTksImV4cCI6MjA4MjA1OTkxOX0.YEqKpy7rdgFyDBd8S_KhPpmQYwRW6wG9niADV_KyBXo', table: 'books' },
            "Trending": { url: 'https://puhcnhgxtqliupofalby.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB1aGNuaGd4dHFsaXVwb2ZhbGJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NDU3NDUsImV4cCI6MjA4MjEyMTc0NX0.X4Tx-EAkkC8bmdlybvZ1-R5S_tQNCQyGvkFDbzbM4tI', table: 'books' },
            "Self Improvement": { url: 'https://zrcwfdqhbpgtiymhgxlu.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpyY3dmZHFoYnBndGl5bWhneGx1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NDczNzksImV4cCI6MjA4MjEyMzM3OX0.pcwvPPlfS2iNFdwQxskRX5bfoCUAXvZEJVNlp4VnkhU', table: 'books' },
            "Hindi Sahitya": { url: 'https://bahljkreizjusetadwpf.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJhaGxqa3JlaXpqdXNldGFkd3BmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NTE5OTIsImV4cCI6MjA4MjEyNzk5Mn0.hQmCGNaUpuR5lQDz1wUCUdhbTb1YTGCGJqS5mXGTdzM', table: 'books' },
            "Hindi Kavya": { url: 'https://dxijesrwqtypifzohxqv.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4aWplc3J3cXR5cGlmem9oeHF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY1NTAyMTIsImV4cCI6MjA4MjEyNjIxMn0.BDgHpRrxNMzXx-9XzPXnS3Oug8ctdJrn9sYj4ED5pM0', table: 'books' },
            "Developers Favourite": { url: 'https://peynnfxeeanqoacljwry.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBleW5uZnhlZWFucW9hY2xqd3J5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NDcwOTYsImV4cCI6MjA4MjMyMzA5Nn0.SguWFCk_6hc_ZNIydcOMNN5JhWjz6IW8yg9ltSIYBeU', table: 'books' },
            "English Books": { url: 'https://hedncgmgfaziuhyqsenq.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhlZG5jZ21nZmF6aXVoeXFzZW5xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NDY5NjMsImV4cCI6MjA4MjMyMjk2M30.VWZ5e3F0NPcTamyAqp3zFFJk_fpvrP1KXLFHBgtT528', table: 'books' },
            "YTC": { url: 'https://tqekzvcyhtlzmmxgpeof.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRxZWt6dmN5aHRsem1teGdwZW9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY2OTk5MzIsImV4cCI6MjA4MjI3NTkzMn0.TnHSB38jHxF7xBZ7D8mx_NPHquUh7UNPYx8DLUQ0S5Q', table: 'books' },
            "Speedy": { url: 'https://ioijcutvombtrvubzqvw.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvaWpjdXR2b21idHJ2dWJ6cXZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NDkwMzcsImV4cCI6MjA4MjMyNTAzN30.kDcEo1JdZfB6G1cw6i1Ye5xykmAGZAk6-5GFswvGbBw', table: 'books' },
            "Ghatnachakra": { url: 'https://pzkzkjjrpvevfkcrwnta.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB6a3prampycHZldmZrY3J3bnRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NDI2NTEsImV4cCI6MjA4MjUxODY1MX0.K6R0IdH1f-efND_52SmfUnO3wA4c_R-TBL-rOHNWuIo', table: 'books' },
            "Kiran Publication": { url: 'https://ekiripyuxavxvcprefof.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVraXJpcHl1eGF2eHZjcHJlZm9mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5Mzg4NzMsImV4cCI6MjA4MjUxNDg3M30.qhslOHy4l0mBO4Rer2NbcNFtS_nj8mSBxh3Ibs8mo_I', table: 'books' },
            "RWA Books": { url: 'https://bpbezqcsvvmxozxtkpyq.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJwYmV6cWNzdnZteG96eHRrcHlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5OTAyNzksImV4cCI6MjA4MjU2NjI3OX0.9dyEpA5n6clEiVMrfGRKwrDsiBNt3T7XWivMMJYiuiw', table: 'books' },
            "Pinnacle": { url: 'https://iyzdybtvzxtqmjsksuuy.supabase.co', key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml5emR5YnR2enh0cW1qc2tzdXV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5OTA5MjksImV4cCI6MjA4MjU2NjkyOX0.XqMF7iE2OeAZmPF1N_T3slvbUkl79LePTmgnkRB3qUk', table: 'books' }
        };

        function getClient(name) {
            const conf = DB_CONFIG[name];
            return { client: supabase.createClient(conf.url, conf.key), table: conf.table };
        }

        let booksCache = [];

        async function fetchHomeBooks() {
            const list = document.getElementById('home-list');
            const { client, table } = getClient("Home");
            const { data, error } = await client.from(table).select('*').order('created_at', {ascending: false});
            booksCache = data || [];
            list.innerHTML = '';
            if(error) return list.innerHTML = `<div class="p-4 text-red-500 text-center">Error loading data</div>`;

            data.forEach(b => {
                const img = b.poster_url || 'https://via.placeholder.com/50';
                list.innerHTML += `
                <div class="grid grid-cols-[50px_1fr_80px] gap-4 p-4 border-b border-slate-50 items-center list-row">
                    <img src="${img}" class="w-10 h-12 object-cover rounded-lg bg-slate-100">
                    <div>
                        <h4 class="font-bold text-sm text-slate-700 truncate">${b.title}</h4>
                        <p class="text-[11px] text-slate-400 line-clamp-1">${b.description || '-'}</p>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button onclick="openEdit(${b.id})" class="h-8 w-8 rounded-full bg-slate-50 hover:bg-indigo-50 text-slate-400 hover:text-indigo-600 transition flex items-center justify-center"><i class="fa-solid fa-pen text-xs"></i></button>
                        <button onclick="delGlobal(${b.id})" class="h-8 w-8 rounded-full bg-slate-50 hover:bg-red-50 text-slate-400 hover:text-red-500 transition flex items-center justify-center"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>
                </div>`;
            });
        }

        async function fetchDailyBooks() {
            const list = document.getElementById('daily-list');
            const { client, table } = getClient("Daily");
            const { data, error } = await client.from(table).select('*').order('created_at', {ascending: false});
            document.getElementById('daily-count').innerHTML = `${data ? data.length : 0}`;
            list.innerHTML = '';
            if(error) return;

            data.forEach(b => {
                const img = b.poster_url || 'https://via.placeholder.com/50';
                list.innerHTML += `
                <div class="flex items-center p-3 border-b border-slate-50 last:border-0 hover:bg-slate-50 transition">
                    <img src="${img}" class="w-8 h-10 rounded object-cover">
                    <div class="flex-1 ml-3">
                        <h4 class="text-xs font-bold text-slate-700 truncate">${b.title}</h4>
                    </div>
                    <button onclick="delDaily('${b.id}')" class="text-slate-300 hover:text-red-500 transition px-2"><i class="fa-solid fa-xmark"></i></button>
                </div>`;
            });
        }

        async function delGlobal(id) {
            const book = booksCache.find(b => b.id === id);
            if(!book || !confirm(`⚠️ Delete "${book.title}" from ALL 14 databases?`)) return;
            await getClient("Home").client.from('books').delete().eq('id', id);
            await getClient("Daily").client.from('books').delete().eq('title', book.title);
            for (const key in DB_CONFIG) {
                if(key !== "Home" && key !== "Daily") getClient(key).client.from('books').delete().eq('title', book.title);
            }
            alert("Deleted everywhere."); fetchHomeBooks();
        }

        async function upload() {
            const title = document.getElementById('in-title').value;
            const desc = document.getElementById('in-desc').value;
            const poster = document.getElementById('in-poster').value;
            const link = document.getElementById('in-link').value;
            const category = document.getElementById('selected-category-value').value;

            if(!title || !link || !category) { alert('Missing Category, Title or Link'); return; }
            const bookData = { title, description: desc, poster_url: poster, book_url: link };

            try {
                await getClient("Daily").client.from('books').insert([bookData]);
                await getClient("Home").client.from('books').insert([bookData]);
                await getClient(category).client.from('books').insert([bookData]);
                alert("✅ Uploaded!"); location.reload();
            } catch (err) { console.error(err); alert("Failed."); }
        }

        async function delDaily(id) {
            if(!confirm("Remove from Daily List?")) return;
            await getClient("Daily").client.from('books').delete().eq('id', id);
            fetchDailyBooks();
        }

        function openEdit(id) {
            const book = booksCache.find(b => b.id === id);
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-old-title').value = book.title;
            document.getElementById('edit-title').value = book.title;
            document.getElementById('edit-poster').value = book.poster_url;
            document.getElementById('edit-link').value = book.book_url;
            document.getElementById('edit-desc').value = book.description;
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        async function saveGlobalEdit() {
            const id = document.getElementById('edit-id').value;
            const oldTitle = document.getElementById('edit-old-title').value;
            const updates = { title: document.getElementById('edit-title').value, poster_url: document.getElementById('edit-poster').value, book_url: document.getElementById('edit-link').value, description: document.getElementById('edit-desc').value };
            try {
                await getClient("Home").client.from('books').update(updates).eq('id', id);
                await getClient("Daily").client.from('books').update(updates).eq('title', oldTitle);
                for (const key in DB_CONFIG) { if(key !== "Home" && key !== "Daily") getClient(key).client.from('books').update(updates).eq('title', oldTitle); }
                alert("Updated!"); closeEdit(); fetchHomeBooks();
            } catch(e) { alert(e.message); }
        }
        function closeEdit() { document.getElementById('edit-modal').classList.add('hidden'); }
    </script>
</body>
</html>